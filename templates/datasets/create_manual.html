{% extends "base.html" %}
{% block title %}Create Dataset Manually{% endblock %}

{% block content %}
<div class="mb-3">
    <h2 class="mb-0">Create Dataset Manually</h2>
    <div class="text-muted">Project: <span class="fw-semibold">{{ project.name }}</span></div>
</div>

<form method="post">
    {% csrf_token %}
    <div class="form-group">
        <label for="project_id">Project</label>
        <select class="form-control" name="project_id" required>
            {% for project in projects %}
                <option value="{{ project.id }}">{{ project.name }}</option>
            {% endfor %}
        </select>
    </div>

    <div class="form-group">
        <label for="dataset_name">Dataset Name</label>
        <input class="form-control" type="text" name="dataset_name" required>
    </div>

    <div class="form-group">
        <label for="description">Description</label>
        <textarea class="form-control" name="description"></textarea>
    </div>

    <div class="form-group">
        <h4>Columns</h4>
        <button type="button" class="btn btn-outline-primary" id="addColumnBtn">Add Column</button>
        <div id="columnsContainer"></div>
    </div>

    <div class="form-group">
        <h4>Rows</h4>
        <button type="button" class="btn btn-outline-primary" id="addRowBtn">Add Row</button>
        <div id="rowsContainer"></div>
    </div>

    <button type="submit" class="btn btn-success">Save Dataset</button>
</form>

<script>
  const columnsContainer = document.getElementById("columnsContainer");
  const rowsContainer = document.getElementById("rowsContainer");
  const addColumnBtn = document.getElementById("addColumnBtn");
  const addRowBtn = document.getElementById("addRowBtn");

  let columns = [];
  let rows = [];

  addColumnBtn.addEventListener("click", function () {
    const columnName = prompt("Enter column name:");
    if (columnName) {
      columns.push({ name: columnName });
      renderColumns();
    }
  });

  addRowBtn.addEventListener("click", function () {
    const row = {};
    columns.forEach(column => {
      const value = prompt(`Enter value for column "${column.name}":`);
      row[column.name] = value || null;
    });
    rows.push(row);
    renderRows();
  });

  function renderColumns() {
    columnsContainer.innerHTML = "";
    columns.forEach(column => {
      const div = document.createElement("div");
      div.textContent = column.name;
      columnsContainer.appendChild(div);
    });
  }

  function renderRows() {
    rowsContainer.innerHTML = "";
    rows.forEach(row => {
      const rowDiv = document.createElement("div");
      Object.keys(row).forEach(columnName => {
        const span = document.createElement("span");
        span.textContent = `${columnName}: ${row[columnName]} `;
        rowDiv.appendChild(span);
      });
      rowsContainer.appendChild(rowDiv);
    });
  }

  document.querySelector("form").addEventListener("submit", function () {
    const columnsJson = JSON.stringify(columns);
    const rowsJson = JSON.stringify(rows);
    document.querySelector("input[name='columns_json']").value = columnsJson;
    document.querySelector("input[name='rows_json']").value = rowsJson;
  });
</script>
{% endblock %}
